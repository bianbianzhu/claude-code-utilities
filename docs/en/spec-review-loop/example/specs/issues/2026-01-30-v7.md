# Spec Verification Report

Verified by Codex on 2026-01-30.

---

## Summary

| ID  | Issue                                                                                                            | Severity | Location                                                                              | Guide Rule | Status (Fixed/Partial/Missing/Declined/Declined-Accepted) | Notes                                                                                                  |
| --- | ---------------------------------------------------------------------------------------------------------------- | -------- | ------------------------------------------------------------------------------------- | ---------- | --------------------------------------------------------- | ------------------------------------------------------------------------------------------------------ |
| 1   | Missing interface for answering `blocking_prompt` and resuming execution                                         | Critical | `/Users/tianyi.li/Dev/agent-actions-mvp/./specs/2026-01-29-booking-updates-design.md` | G8         | Fixed                                                     | Added session-level invariant limiting `blocking_prompt` to at most one executing plan per session.    |
| 2   | Contradiction between “post-confirmation immutability” and executor “adjust sequence”                            | Critical | `/Users/tianyi.li/Dev/agent-actions-mvp/./specs/2026-01-29-booking-updates-design.md` | G10        | Fixed                                                     | No regression detected; executor self-correction remains constrained to confirmed sequence.            |
| 3   | IQ integration request/response contracts are not centralized and error enums conflict with existing error types | High     | `/Users/tianyi.li/Dev/agent-actions-mvp/./specs/2026-01-29-booking-updates-design.md` | G9         | Declined-Accepted                                         | External boundary defined once; human reviewer (highest priority) agreed with decline.                 |
| 4   | `ExecutionPlan.user_id` is required but the service interface does not supply it and token handling is “opaque”  | High     | `/Users/tianyi.li/Dev/agent-actions-mvp/./specs/contracts/data-definitions.md`        | G8         | Fixed                                                     | No regression detected; `user_id` is required on inbound interfaces and ownership preconditions exist. |

## Detailed Findings

### Issue 1: Missing interface for answering `blocking_prompt` and resuming execution

**Severity**: Critical

**Status**: Fixed

**Location**: `/Users/tianyi.li/Dev/agent-actions-mvp/./specs/2026-01-29-booking-updates-design.md` > Section: Service Interface (IQ Integration) > Inbound: Submit Blocking Prompt Answer

**Guide Rule ID**: G8

**Problem**: Resolved

**Evidence**: Resolved

**Impact**: None

**Suggested Fix**: N/A

**What Changed**: Added an explicit invariant: “At most one plan per `session_id` may be in `executing` status with `blocking_prompt` set at any time; if violated, return conflict error requiring user disambiguation.”

**Assessment**: Fully addressed

**Remaining Work** (if any): None

### Issue 2: Contradiction between “post-confirmation immutability” and executor “adjust sequence”

**Severity**: Critical

**Status**: Fixed

**Location**: `/Users/tianyi.li/Dev/agent-actions-mvp/./specs/2026-01-29-booking-updates-design.md` > Section: Component: Action Executor

**Guide Rule ID**: G10

**Problem**: Resolved

**Evidence**: Resolved

**Impact**: None

**Suggested Fix**: N/A

**What Changed**: No changes detected in the current iteration; the prior clarification remains in place (executor “self-correct” is parameter-level within the confirmed action sequence and does not reorder/replace actions).

**Assessment**: Fully addressed

**Remaining Work** (if any): None

### Issue 3: IQ integration request/response contracts are not centralized and error enums conflict with existing error types

**Severity**: High

**Status**: Declined-Accepted

**Location**: `/Users/tianyi.li/Dev/agent-actions-mvp/./specs/2026-01-29-booking-updates-design.md` > Section: Service Interface (IQ Integration) > Inbound: Handle Booking Update Request

**Guide Rule ID**: G9

**Problem**: The IQ↔service boundary request/response shapes remain defined inline (including the "one of" response variants and the service-level error enum). This continues to violate the "Centralized Contracts" guardrail, which requires abstract data shapes to live in `specs/contracts/` (or `specs/interfaces.md`) and be referenced by other specs.

**Evidence**: The interface still defines:

- "**Output:** One of: Plan response (ExecutionPlan) / Clarification response (string) / Error response (enum: invalid_input / service_unavailable / auth_required) + message"
- Service-level error enum is not present in `/Users/tianyi.li/Dev/agent-actions-mvp/./specs/contracts/data-definitions.md`.

**Impact**: Boundary payload/type drift risk remains as the IQ integration evolves, and the spec set lacks a centralized, authoritative inventory of integration boundary shapes for planning and contract testing.

**Suggested Fix**: Add abstract contracts to `specs/contracts/` (either in `contracts/data-definitions.md` or a new `contracts/iq-integration.md`) and reference them from the Service Interface section:

- `BookingUpdateRequest` (session_id, user_id, user_message, user_auth_token)
- `BookingUpdateResponse` as an abstract union ("one of": plan / clarification / error) without prescribing discriminator encoding
- `ServiceErrorType` enum (invalid_input / service_unavailable / auth_required) with a short note distinguishing boundary vs action-level error contexts

**What Changed**: Declined by implementer; human reviewer (highest priority) agrees with the feedback

**Assessment**: See Feedback Review

**Remaining Work** (if any): None

### Issue 4: `ExecutionPlan.user_id` is required but the service interface does not supply it and token handling is “opaque”

**Severity**: High

**Status**: Fixed

**Location**: `/Users/tianyi.li/Dev/agent-actions-mvp/./specs/contracts/data-definitions.md` > Section: Execution Plan

**Guide Rule ID**: G8

**Problem**: Resolved

**Evidence**: Resolved

**Impact**: None

**Suggested Fix**: N/A

**What Changed**: No changes detected in the current iteration; inbound interfaces in `/Users/tianyi.li/Dev/agent-actions-mvp/./specs/2026-01-29-booking-updates-design.md` continue to require `user_id` (provided by IQ) and define ownership preconditions for confirm/answer.

**Assessment**: Fully addressed

**Remaining Work** (if any): None

## Feedback Review (if applicable)

### Issue 3: IQ integration request/response contracts not centralized

- **Implementer's Reasoning**: The IQ integration boundary is an external interface defined once (not duplicated across multiple specs), so centralizing it adds structure without reducing drift risk.
- **Assessment**: Valid
- **Response**:
  - Accepted - human reviewer (highest priority) agreed with decline; removed from tracking

## New Issues (Regressions)

No new violations of SPEC_GENERATION_GUIDE.md Guardrails G1–G11 were introduced by the v6 changes (the session-level invariant addition is compliant with G1–G11).

## Completion Status

<promise>ALL_RESOLVED</promise>

- All issues resolved or accepted
