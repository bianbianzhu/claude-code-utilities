# Spec Review v12 Processing Summary

Processed: 2026-01-30

## Issue Summary

| Issue ID | Title | Decision | Changes Applied | Guide Rule IDs |
|----------|-------|----------|-----------------|----------------|
| 1 | Get Plan Status Missing AuthZ Context (IDOR Risk) | Accepted | Added `user_id` + auth token input, ownership precondition, and error cases (401/403/404) to Get Plan Status endpoint | G8 |
| 2 | Queue Failure Recovery Contradicts Confirm Plan Idempotency | Accepted | Clarified that queue insertion failure keeps plan in `pending_confirmation` status, allowing re-confirm to re-attempt enqueue | G10 |
| 3 | Metadata Overlay Field Name Drift vs Central Contract | Accepted | Standardized on `iq_enabled` (underscore) in design spec prose to match contract | G9 |
| 4 | Central Contract Type System Is Internally Inconsistent (`time` Undefined) | Accepted | Added `time` to primitive type enum; added constraint "HH:MM local venue time" to `booking_time` field | Checklist |

## Details

### Issue 1: Get Plan Status Missing AuthZ Context (IDOR Risk)
- **Decision:** Accepted
- **Changes Applied:**
  - Updated "Get Plan Status" input to include `user_id` (string) and user auth token
  - Added precondition: `user_id` must match plan creator
  - Added error cases: Plan not found (404), user mismatch (403), invalid/missing auth (401)
- **Files Modified:** `specs/2026-01-29-booking-updates-design.md`

### Issue 2: Queue Failure Recovery Contradicts Confirm Plan Idempotency
- **Decision:** Accepted
- **Changes Applied:**
  - Clarified in "LLM Planner â†’ Queue Manager" cross-module interface that if queue insertion fails, plan status remains `pending_confirmation` (not `confirmed`)
  - This resolves the contradiction: re-confirming a plan that failed to enqueue is not a no-op since it's still in `pending_confirmation` state
- **Files Modified:** `specs/2026-01-29-booking-updates-design.md`

### Issue 3: Metadata Overlay Field Name Drift vs Central Contract
- **Decision:** Accepted
- **Changes Applied:**
  - Changed `iq-enabled: true` to `iq_enabled: true` in the Transformation Rules prose to match the canonical field name in `contracts/data-definitions.md`
- **Files Modified:** `specs/2026-01-29-booking-updates-design.md`

### Issue 4: Central Contract Type System Is Internally Inconsistent (`time` Undefined)
- **Decision:** Accepted
- **Changes Applied:**
  - Added `time` to the Action Parameter type enum: `string / number / boolean / date / datetime / time / enum`
  - Added constraint "HH:MM local venue time" to the `booking_time` field in Booking Summary
- **Files Modified:** `specs/contracts/data-definitions.md`

## Files Modified

- `specs/2026-01-29-booking-updates-design.md` (Issues 1, 2, 3)
- `specs/contracts/data-definitions.md` (Issue 4)
