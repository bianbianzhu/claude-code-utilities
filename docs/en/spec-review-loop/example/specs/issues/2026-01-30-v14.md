# Spec Verification Report

Verified by Codex on 2026-01-29.

---

## Summary
| ID | Issue | Severity | Location | Guide Rule | Status (Fixed/Partial/Missing/Declined/Declined-Accepted) | Notes |
|----|-------|----------|----------|------------|------------------------------------------------------------|-------|
| 1 | Get Plan Status Missing AuthZ Context (IDOR Risk) | Critical | `/Users/tianyi.li/Dev/agent-actions-mvp/./specs/2026-01-29-booking-updates-design.md` | G8 | Fixed | Still includes `user_id` + auth token + ownership precondition + 401/403 cases. |
| 2 | Queue Failure Recovery Contradicts Confirm Plan Idempotency and State Model | High | `/Users/tianyi.li/Dev/agent-actions-mvp/./specs/2026-01-29-booking-updates-design.md` | G10 | Partial | Confirm Plan + state model are now conditional and define inbound error semantics; cross-module “Data passed” still mixes `confirmed` vs `pending_confirmation` semantics. |
| 3 | Metadata Overlay Field Name Drift vs Central Contract | High | `/Users/tianyi.li/Dev/agent-actions-mvp/./specs/2026-01-29-booking-updates-design.md` | G9 | Fixed | `iq_enabled` naming remains consistent with centralized contract. |
| 4 | Central Contract Type System Is Internally Inconsistent (`time` Undefined) | High | `/Users/tianyi.li/Dev/agent-actions-mvp/./specs/contracts/data-definitions.md` | Checklist (Type sufficiency) | Fixed | Added canonical primitive definition for `time` (HH:MM 24-hour) and aligned usages. |

## Detailed Findings

### Issue 1: Get Plan Status Missing AuthZ Context (IDOR Risk)

**Severity**: Critical

**Status**: Fixed

**Location**: `/Users/tianyi.li/Dev/agent-actions-mvp/./specs/2026-01-29-booking-updates-design.md` > Section: Service Interface (IQ Integration) → Inbound: Get Plan Status

**Guide Rule ID**: G8

**Problem**: Resolved

**Evidence**: Resolved

**Impact**: None

**Suggested Fix**: N/A

**What Changed**: No changes detected since v13; the inbound contract still requires `plan_id`, `user_id`, and user auth token, declares the ownership precondition, and covers auth-related errors (401/403).

**Assessment**: Fully addressed

**Remaining Work** (if any): None

---

### Issue 2: Queue Failure Recovery Contradicts Confirm Plan Idempotency and State Model

**Severity**: High

**Status**: Partial

**Location**: `/Users/tianyi.li/Dev/agent-actions-mvp/./specs/2026-01-29-booking-updates-design.md` > Section: Cross-Module Interfaces → LLM Planner → Queue Manager; Service Interface (IQ Integration) → Inbound: Confirm Plan; State Model

**Guide Rule ID**: G10

**Problem**: The inbound “Confirm Plan” contract and state model are now aligned with enqueue-success conditionality, but the “LLM Planner → Queue Manager” cross-module interface still mixes status semantics in a way that can be read as contradictory (payload says `status: confirmed` while failure handling says plan status remains `pending_confirmation` on insertion failure).

**Evidence**:
- Cross-module interface states:
  - **Data passed:** “Execution Plan (status: confirmed)”
  - **Error handling:** “If queue insertion fails, plan status remains `pending_confirmation`…”
- Inbound Confirm Plan now states:
  - “On enqueue success: persists status as `confirmed`…”
  - “On enqueue failure: status remains `pending_confirmation`…”

**Impact**: Implementers can still misinterpret whether the queued payload’s `status` should be `confirmed` vs `pending_confirmation`, and whether the `status` field is intended to describe persisted state vs an intended/ephemeral state at enqueue time. This risks drift between queue payload, persistence, and state machine assumptions.

**Suggested Fix**:
- Update the “LLM Planner → Queue Manager” interface to make the status semantics explicit, e.g.:
  - Change **Data passed** to “ExecutionPlan (current persisted status: `pending_confirmation`) + intended transition: confirm-on-enqueue-success”, or
  - Keep `status: confirmed` in the payload but explicitly state that persistence to `confirmed` occurs only after enqueue acknowledgement (and that enqueue attempts may use an ephemeral “to-be-confirmed” representation).

**What Changed**: “Inbound: Confirm Plan” now defines enqueue success vs failure paths (including ServiceError on enqueue failure), idempotency, and error cases; the state model transition label and invariants were updated to require “enqueue succeeds”.

**Assessment**: Partially addressed — the main boundary/state ambiguity is resolved, but the remaining cross-module interface wording can still cause interpretation drift.

**Remaining Work** (if any): Clarify the “LLM Planner → Queue Manager” “Data passed” status semantics so it cannot be read as conflicting with the “enqueue succeeds” requirement for persisting `confirmed`.

---

### Issue 3: Metadata Overlay Field Name Drift vs Central Contract

**Severity**: High

**Status**: Fixed

**Location**: `/Users/tianyi.li/Dev/agent-actions-mvp/./specs/2026-01-29-booking-updates-design.md` > Section: Component: Action Transformer → Transformation Rules

**Guide Rule ID**: G9

**Problem**: Resolved

**Evidence**: Resolved

**Impact**: None

**Suggested Fix**: N/A

**What Changed**: No changes detected since v13; the design spec continues to reference `iq_enabled` and the centralized contract continues to define `iq_enabled` as the canonical field name.

**Assessment**: Fully addressed

**Remaining Work** (if any): None

---

### Issue 4: Central Contract Type System Is Internally Inconsistent (`time` Undefined)

**Severity**: High

**Status**: Fixed

**Location**: `/Users/tianyi.li/Dev/agent-actions-mvp/./specs/contracts/data-definitions.md` > Section: Primitive Type Definitions; Action Parameter; Booking Summary

**Guide Rule ID**: Checklist item — “Data definitions are sufficient to generate shared types during planning phase”

**Problem**: Resolved

**Evidence**: Resolved

**Impact**: None

**Suggested Fix**: N/A

**What Changed**: Added a centralized “Primitive Type Definitions” table defining canonical `time` representation as a `string` constrained to `HH:MM` (24-hour), and kept ActionParameter’s primitive type enum and `BookingSummary.booking_time` aligned with that definition.

**Assessment**: Fully addressed

**Remaining Work** (if any): None

## Feedback Review (if applicable)

No feedback file present at `/Users/tianyi.li/Dev/agent-actions-mvp/./specs/issues/2026-01-30-v13-feedback.md`.

## New Issues (Regressions)

No new SPEC_GENERATION_GUIDE.md Guardrails G1–G11 violations introduced by the applied fixes were detected.

## Completion Status

<promise>ISSUES_REMAINING</promise>

Remaining issue IDs: 2
